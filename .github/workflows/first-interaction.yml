name: First Contribution Welcome

on:
  issues:
    types: [opened]

  pull_request_target:
    types: [opened]

permissions:
  issues: write
  pull-requests: write

jobs:
  welcome:
    runs-on: ubuntu-latest
    steps:
      - name: Welcome first-time contributor
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const isPR = Boolean(context.payload.pull_request);

            const author = isPR
              ? context.payload.pull_request.user.login
              : context.payload.issue.user.login;

            const repo = `${context.repo.owner}/${context.repo.repo}`;
            const currentNumber = context.issue.number;

            const query = isPR
              ? `repo:${repo} is:pr author:${author}`
              : `repo:${repo} is:issue author:${author}`;

            const { data } = await github.rest.search.issuesAndPullRequests({ q: query });

            const previousItems = data.items.filter(
              item => item.number !== currentNumber
            );

            if (previousItems.length === 0) {
              const message = isPR
                ? `ðŸŽ‰ **Welcome @${author}!**<br><br>
                   Congratulations on submitting your very first Pull Request ðŸš€  
                   Weâ€™re excited to have you contributing to this project.<br><br>

                   Please feel free to respond to any review comments or ask questions â€” weâ€™re happy to help!<br><br>

                   <a href="https://github.com/${repo}" target="_blank">
                     <picture>
                       <img width="600"
                         src="https://raw.githubusercontent.com/Vatsal-Verma/test/main/.github/images/welcome.svg"
                         alt="Welcome banner">
                     </picture>
                   </a>`
                : `ðŸ‘‹ **Hi @${author}, welcome!**<br><br>
                   Thanks for opening your very first issue ðŸŽ‰  
                   Your feedback helps make this project better for everyone.<br><br>

                   A maintainer will review this shortly. Thanks for taking the time to contribute!<br><br>

                   <picture>
                     <img width="600"
                       src="https://raw.githubusercontent.com/Vatsal-Verma/test/main/.github/images/welcome.svg"
                       alt="Welcome banner">
                   </picture>`;

              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: currentNumber,
                body: message
              });
            }
